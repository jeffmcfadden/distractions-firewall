#!/bin/bash
# about using the `set`, `commit`, etc. aliases over a non-interactive shell,
# see
# see http://community.ubnt.com/t5/EdgeMAX-Beta/commit-fails-for-firewall-group-from-CLI-scripts/m-p/1177264#M8437
function prepare_command() {
prefix='/opt/vyatta/sbin/vyatta-cfg-cmd-wrapper '
r=`echo -n "$1" | tr '\n' ';' | sed "s%;\([ \t\v\f]*[^ \t\v\f;#]\+\)%;$prefix\1%g" | tr ';' '\n'`
echo -n "$prefix$r"
}
 
# first prepare the command in `cmd`, then apply in over ssh
cmd=`prepare_command "begin
set firewall name ETH1_IN rule 2 disable
commit
save
end"`

echo "$cmd"

ssh jeff@192.168.201.1 -i ~/.ssh/id_rsa_edgerouter_lite "/opt/vyatta/bin/vyatta-op-cmd-wrapper \"set firewall name ETH1_IN rule 2 disable\""


https://community.ubnt.com/t5/EdgeMAX/GUI-not-updating-number-of-group-members-for-Firewall-Group/m-p/1685174/highlight/false#M129456
https://community.ubnt.com/t5/EdgeMAX/script-to-change-configuration-not-working/td-p/640689
https://community.ubnt.com/t5/EdgeMAX/How-enable-firewall-rule-in-CLI/td-p/540836
https://github.com/remfalc/vyt-vyatta-cfg/blob/master/scripts/vyatta-cfg-cmd-wrapper
https://wiki.vyos.net/wiki/Command_scripting
https://community.ubnt.com/t5/EdgeMAX/Configure-ER-over-non-interactive-SSH/td-p/1618544
https://community.ubnt.com/t5/EdgeMAX/ssh-authorized-keys/td-p/458361
https://community.ubnt.com/t5/EdgeMAX/Unable-to-delete-address-group-entries-with-leading-whitespace/td-p/1243857